<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="apple-touch-icon" href="fedithready-favicon.png">
    <link rel="icon" href="fedithready-favicon.png" type="image/x-icon">
    <meta property="og:image" content="images/social_preview.png">
    <title>FediThready</title>

    <!-- Bootstrap CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>

<div class="container mt-3">
    <div class="header">
        <h1 class="display-4"><img id="header-icon" src="fedithready-icon.svg" aria-hidden="true"  />FediThready</h1>
        <span class="subheading">Make long text into post sized chunks.</span>
    </div>

    <div class="row">
        <div class="col-md-6">

            <h3 style="display: inline-block; float: left;">Write Your Text</h3>
            <button id="clearText"
                    class="btn btn-warning btn-copy-style"
                    style="float: right; display: inline-block; position: relative; top: 0.75rem;"
                    aria-controls="inputText">Clear Current Text</button>

            <input type="text"
                   id="contentWarning"
                   class="form-control mb-2"
                   placeholder="⚠️ optional content warning">

            <textarea id="inputText"
                      class="form-control"
                      placeholder="Type your thread here."
                      rows="10"></textarea>

            <div class="settings mt-3 d-flex justify-content-between">
                <div style="width: 100%">
                    <label for="charLimit">Character Limit</label>:
                    <input type="number" id="charLimit" value="500" min="1">

                    <br />
                    <label for="paginationCheckbox">Include counter</label>:
                    <input type="checkbox" id="paginationCheckbox" checked>

                    <br /><label for="sentenceEndingsCheckbox">Attempt sentence endings</label>:
                    <input type="checkbox" id="sentenceEndingsCheckbox" checked>

                    <br /><label for="includeUsernamesCheckbox">Include usernames in replies</label>:
                    <input type="checkbox" id="includeUsernamesCheckbox">

                    <button id="applyLimit" class="btn btn-primary btn-copy-style" style="float: right;">Apply Settings</button>
            </div>

    </div>

            <div class="mastodon-controls mt-3">
                <button id="logoutButton" class="btn btn-outline-secondary" style="display: none;">Disconnect</button>
            </div>


            <!-- Advice section -->

            <div class="advice">
                <h3>Advice</h3>
                <ol>
                    <li>In the "Write your Text" section above, input your lengthy text.</li>
                    <li>Adjust the character limit or disable pagination if needed.</li>
                    <li>Insert three or more hyphens "---", asterisks "***", or underscores "___" for a manual split.</li>
                    <li>View the real-time preview on the right. Use the "Copy" button to copy individual posts.</li>
                    <li>Paste the posts into your Mastodon, or any other Fediverse app.</li>
                </ol>
            </div>
        </div>

        <div class="col-md-6 line-limited" id="scrollingPreview">
            <h3>Preview</h3>
            <div class="mastodon-controls mb-2">
                <button id="mastodonButton" class="btn btn-success">Log in to post</button>
                <button id="logoutButton" class="btn btn-outline-secondary" style="display: none;">Disconnect</button>
                <div id="postStatus" class="post-status-message" style="display: none;"></div>
            </div>

            <div class="visibility-selector mb-2">
                <label for="visibilitySelect">Visibility:</label>
                <select id="visibilitySelect" class="form-control d-inline-block" style="width: auto; margin-left: 5px;">
                    <option value="public" selected>Public</option>
                    <option value="unlisted">Unlisted</option>
                    <option value="private">Followers only</option>
                    <option value="direct">Direct</option>
                </select>
            </div>

            <div class="accordion mb-2" id="replyToSection" style="display: none;">
                <div class="accordion-item">
                    <h2 class="accordion-header" id="replyToHeader">
                        <button class="accordion-button collapsed" type="button" data-toggle="collapse"
                                data-target="#replyToCollapse" aria-expanded="false" aria-controls="replyToCollapse">
                            Reply to post…
                        </button>
                    </h2>
                    <div id="replyToCollapse" class="accordion-collapse collapse" aria-labelledby="replyToHeader" data-parent="#replyToSection">
                        <div class="accordion-body">
                            <div class="input-group">
                                <input type="text" id="replyToUrl" class="form-control"
                                       placeholder="https://mastodon.social/@user/123456789">
                                <div class="input-group-append">
                                    <button class="btn btn-outline-secondary" type="button"
                                            id="clearReplyTo" title="Clear">&times;</button>
                                </div>
                            </div>
                            <small id="replyToStatus" class="form-text"></small>
                            <div id="replyToPreview" class="reply-to-preview" style="display: none;">
                                <div class="preview-header">
                                    <strong>Replying to:</strong>
                                    <span id="replyToAuthor"></span>
                                </div>
                                <div id="replyToContent" class="preview-content"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="previewArea"></div>
        </div>
    </div>
</div>




<!-- Error Modal -->
<div id="errorModal" class="modal-overlay" style="display: none;">
    <div class="modal-content">
        <span class="modal-close">&times;</span>
        <h3>Unable to Post</h3>
        <p id="errorModalMessage"></p>
        <button id="errorModalCloseBtn" class="btn btn-primary mt-3">Understood…</button>
    </div>
</div>

<!-- Login Modal -->
<div id="loginModal" class="modal-overlay" style="display: none;">
    <div class="modal-content">
        <span class="modal-close">&times;</span>
        <h3>Connect to Mastodon</h3>

        <!-- File protocol error -->
        <div id="fileProtocolError" style="display: none;">
            <p class="status-error">For security reasons, posting to Mastodon requires loading FediThready from a web server.</p>
            <p>Visit <a href="https://fedithready.app" target="_blank"><strong>fedithready.app</strong></a> to use the posting feature.</p>
            <p class="text-muted small">Without one, you can still use FediThready to split text and paste into Mastodon.</p>
        </div>

        <!-- Enter instance -->
        <div id="instanceStep">
            <p>Enter your Mastodon instance domain:</p>
            <input type="text" id="instanceInput" class="form-control" placeholder="mastodon.social">
            <button id="authorizeBtn" class="btn btn-primary mt-3">Authorize</button>
        </div>

        <div id="modalError" class="modal-error" style="display: none;"></div>
    </div>
</div>

<!-- Reply URL Conflict Modal -->
<div id="replyUrlConflictModal" class="modal-overlay" style="display: none;">
    <div class="modal-content">
        <span class="modal-close">&times;</span>
        <h3>Reply URL Conflict</h3>
        <p>You were already working on a reply to another post. What would you like to do?</p>
        <div class="d-flex flex-column">
            <button id="replyUrlKeepTextBtn" class="btn btn-primary mb-2">Keep my text, change the reply-to URL</button>
            <button id="replyUrlClearAllBtn" class="btn btn-warning mb-2">Clear everything and start fresh</button>
            <button id="replyUrlCancelBtn" class="btn btn-secondary">Do nothing</button>
        </div>
    </div>
</div>

<footer class="footer text-center py-4 mt-5">
    <div class="container">
        <span class="">Credits & Source code on </span>
        <a href="https://github.com/masukomi/fedithready" target="_blank">GitHub</a>
    </div>
</footer>

<!-- jQuery and Bootstrap JS -->
<script src="js/jquery-3.5.1.min.js"></script>
<script src="js/bootstrap.bundle.min.js"></script>

<!-- Mastodon API -->
<script src="js/mastodon-api.js"></script>

<!-- Custom JS -->
<script src="js/script.js"></script>

</body>
</html>
